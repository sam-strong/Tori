<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Module: Net::SSH::Transport::PacketStream</title>

  <link rel="stylesheet" href="../../../rdoc.css" type="text/css" media="screen" />

  <script src="../../../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="module">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../../../index.html">Home</a>
          <a href="../../../index.html#classes">Classes</a>
          <a href="../../../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../../../lib/net/ssh/transport/packet_stream_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/net/ssh/transport/packet_stream.rb">lib/net/ssh/transport/packet_stream.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-extended">::extended</a></li>
          
          <li><a href="#method-i-available_for_read-3F">#available_for_read?</a></li>
          
          <li><a href="#method-i-cleanup">#cleanup</a></li>
          
          <li><a href="#method-i-client_name">#client_name</a></li>
          
          <li><a href="#method-i-enqueue_packet">#enqueue_packet</a></li>
          
          <li><a href="#method-i-if_needs_rekey-3F">#if_needs_rekey?</a></li>
          
          <li><a href="#method-i-initialize_ssh">#initialize_ssh</a></li>
          
          <li><a href="#method-i-next_packet">#next_packet</a></li>
          
          <li><a href="#method-i-peer_ip">#peer_ip</a></li>
          
          <li><a href="#method-i-poll_next_packet">#poll_next_packet</a></li>
          
          <li><a href="#method-i-send_packet">#send_packet</a></li>
          
        </ul>
      </div>
      

      
      <!-- Included Modules -->
      <div id="includes-section" class="section">
        <h3 class="section-header">Included Modules</h3>
        <ul class="link-list">
        
        
          <li><a class="include" href="../BufferedIo.html">Net::SSH::BufferedIo</a></li>
        
        
        </ul>
      </div>
      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="../../../LICENSE_txt.html">LICENSE.txt</a></li>
        
          <li class="file"><a href="../../../README_rdoc.html">README.rdoc</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../../../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../../../Net.html">Net</a></li>
        
          <li><a href="../../../Net/SSH.html">Net::SSH</a></li>
        
          <li><a href="../../../Net/SSH/Authentication.html">Net::SSH::Authentication</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/Agent.html">Net::SSH::Authentication::Agent</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/Agent/Comment.html">Net::SSH::Authentication::Agent::Comment</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/Agent/Key.html">Net::SSH::Authentication::Agent::Key</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/AgentError.html">Net::SSH::Authentication::AgentError</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/AgentNotAvailable.html">Net::SSH::Authentication::AgentNotAvailable</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/Constants.html">Net::SSH::Authentication::Constants</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/DisallowedMethod.html">Net::SSH::Authentication::DisallowedMethod</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/KeyManager.html">Net::SSH::Authentication::KeyManager</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/KeyManagerError.html">Net::SSH::Authentication::KeyManagerError</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/Methods.html">Net::SSH::Authentication::Methods</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/Methods/Abstract.html">Net::SSH::Authentication::Methods::Abstract</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/Methods/Hostbased.html">Net::SSH::Authentication::Methods::Hostbased</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/Methods/KeyboardInteractive.html">Net::SSH::Authentication::Methods::KeyboardInteractive</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/Methods/None.html">Net::SSH::Authentication::Methods::None</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/Methods/Password.html">Net::SSH::Authentication::Methods::Password</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/Methods/Publickey.html">Net::SSH::Authentication::Methods::Publickey</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/Pageant.html">Net::SSH::Authentication::Pageant</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/Pageant/Socket.html">Net::SSH::Authentication::Pageant::Socket</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/Pageant/Socket19.html">Net::SSH::Authentication::Pageant::Socket19</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/Pageant/Win.html">Net::SSH::Authentication::Pageant::Win</a></li>
        
          <li><a href="../../../Net/SSH/Authentication/Session.html">Net::SSH::Authentication::Session</a></li>
        
          <li><a href="../../../Net/SSH/AuthenticationFailed.html">Net::SSH::AuthenticationFailed</a></li>
        
          <li><a href="../../../Net/SSH/Buffer.html">Net::SSH::Buffer</a></li>
        
          <li><a href="../../../Net/SSH/BufferedIo.html">Net::SSH::BufferedIo</a></li>
        
          <li><a href="../../../Net/SSH/ChannelOpenFailed.html">Net::SSH::ChannelOpenFailed</a></li>
        
          <li><a href="../../../Net/SSH/ChannelRequestFailed.html">Net::SSH::ChannelRequestFailed</a></li>
        
          <li><a href="../../../Net/SSH/Compat.html">Net::SSH::Compat</a></li>
        
          <li><a href="../../../Net/SSH/Config.html">Net::SSH::Config</a></li>
        
          <li><a href="../../../Net/SSH/Connection.html">Net::SSH::Connection</a></li>
        
          <li><a href="../../../Net/SSH/Connection/Channel.html">Net::SSH::Connection::Channel</a></li>
        
          <li><a href="../../../Net/SSH/Connection/Constants.html">Net::SSH::Connection::Constants</a></li>
        
          <li><a href="../../../Net/SSH/Connection/Session.html">Net::SSH::Connection::Session</a></li>
        
          <li><a href="../../../Net/SSH/Connection/Session/NilChannel.html">Net::SSH::Connection::Session::NilChannel</a></li>
        
          <li><a href="../../../Net/SSH/Connection/Term.html">Net::SSH::Connection::Term</a></li>
        
          <li><a href="../../../Net/SSH/ConnectionTimeout.html">Net::SSH::ConnectionTimeout</a></li>
        
          <li><a href="../../../Net/SSH/Disconnect.html">Net::SSH::Disconnect</a></li>
        
          <li><a href="../../../Net/SSH/Exception.html">Net::SSH::Exception</a></li>
        
          <li><a href="../../../Net/SSH/ForwardedBufferedIo.html">Net::SSH::ForwardedBufferedIo</a></li>
        
          <li><a href="../../../Net/SSH/HostKeyError.html">Net::SSH::HostKeyError</a></li>
        
          <li><a href="../../../Net/SSH/HostKeyMismatch.html">Net::SSH::HostKeyMismatch</a></li>
        
          <li><a href="../../../Net/SSH/HostKeyUnknown.html">Net::SSH::HostKeyUnknown</a></li>
        
          <li><a href="../../../Net/SSH/KeyFactory.html">Net::SSH::KeyFactory</a></li>
        
          <li><a href="../../../Net/SSH/KnownHosts.html">Net::SSH::KnownHosts</a></li>
        
          <li><a href="../../../Net/SSH/Loggable.html">Net::SSH::Loggable</a></li>
        
          <li><a href="../../../Net/SSH/Packet.html">Net::SSH::Packet</a></li>
        
          <li><a href="../../../Net/SSH/PromptMethods.html">Net::SSH::PromptMethods</a></li>
        
          <li><a href="../../../Net/SSH/PromptMethods/Clear.html">Net::SSH::PromptMethods::Clear</a></li>
        
          <li><a href="../../../Net/SSH/PromptMethods/Highline.html">Net::SSH::PromptMethods::Highline</a></li>
        
          <li><a href="../../../Net/SSH/PromptMethods/Termios.html">Net::SSH::PromptMethods::Termios</a></li>
        
          <li><a href="../../../Net/SSH/Proxy.html">Net::SSH::Proxy</a></li>
        
          <li><a href="../../../Net/SSH/Proxy/Command.html">Net::SSH::Proxy::Command</a></li>
        
          <li><a href="../../../Net/SSH/Proxy/ConnectError.html">Net::SSH::Proxy::ConnectError</a></li>
        
          <li><a href="../../../Net/SSH/Proxy/Error.html">Net::SSH::Proxy::Error</a></li>
        
          <li><a href="../../../Net/SSH/Proxy/HTTP.html">Net::SSH::Proxy::HTTP</a></li>
        
          <li><a href="../../../Net/SSH/Proxy/SOCKS4.html">Net::SSH::Proxy::SOCKS4</a></li>
        
          <li><a href="../../../Net/SSH/Proxy/SOCKS5.html">Net::SSH::Proxy::SOCKS5</a></li>
        
          <li><a href="../../../Net/SSH/Proxy/UnauthorizedError.html">Net::SSH::Proxy::UnauthorizedError</a></li>
        
          <li><a href="../../../Net/SSH/Service.html">Net::SSH::Service</a></li>
        
          <li><a href="../../../Net/SSH/Service/Forward.html">Net::SSH::Service::Forward</a></li>
        
          <li><a href="../../../Net/SSH/Test.html">Net::SSH::Test</a></li>
        
          <li><a href="../../../Net/SSH/Test/Channel.html">Net::SSH::Test::Channel</a></li>
        
          <li><a href="../../../Net/SSH/Test/Extensions.html">Net::SSH::Test::Extensions</a></li>
        
          <li><a href="../../../Net/SSH/Test/Extensions/BufferedIo.html">Net::SSH::Test::Extensions::BufferedIo</a></li>
        
          <li><a href="../../../Net/SSH/Test/Extensions/Channel.html">Net::SSH::Test::Extensions::Channel</a></li>
        
          <li><a href="../../../Net/SSH/Test/Extensions/IO.html">Net::SSH::Test::Extensions::IO</a></li>
        
          <li><a href="../../../Net/SSH/Test/Extensions/IO/ClassMethods.html">Net::SSH::Test::Extensions::IO::ClassMethods</a></li>
        
          <li><a href="../../../Net/SSH/Test/Extensions/PacketStream.html">Net::SSH::Test::Extensions::PacketStream</a></li>
        
          <li><a href="../../../Net/SSH/Test/Kex.html">Net::SSH::Test::Kex</a></li>
        
          <li><a href="../../../Net/SSH/Test/LocalPacket.html">Net::SSH::Test::LocalPacket</a></li>
        
          <li><a href="../../../Net/SSH/Test/Packet.html">Net::SSH::Test::Packet</a></li>
        
          <li><a href="../../../Net/SSH/Test/RemotePacket.html">Net::SSH::Test::RemotePacket</a></li>
        
          <li><a href="../../../Net/SSH/Test/Script.html">Net::SSH::Test::Script</a></li>
        
          <li><a href="../../../Net/SSH/Test/Socket.html">Net::SSH::Test::Socket</a></li>
        
          <li><a href="../../../Net/SSH/Transport.html">Net::SSH::Transport</a></li>
        
          <li><a href="../../../Net/SSH/Transport/Algorithms.html">Net::SSH::Transport::Algorithms</a></li>
        
          <li><a href="../../../Net/SSH/Transport/CTR.html">Net::SSH::Transport::CTR</a></li>
        
          <li><a href="../../../Net/SSH/Transport/CipherFactory.html">Net::SSH::Transport::CipherFactory</a></li>
        
          <li><a href="../../../Net/SSH/Transport/Constants.html">Net::SSH::Transport::Constants</a></li>
        
          <li><a href="../../../Net/SSH/Transport/HMAC.html">Net::SSH::Transport::HMAC</a></li>
        
          <li><a href="../../../Net/SSH/Transport/HMAC/Abstract.html">Net::SSH::Transport::HMAC::Abstract</a></li>
        
          <li><a href="../../../Net/SSH/Transport/HMAC/MD5.html">Net::SSH::Transport::HMAC::MD5</a></li>
        
          <li><a href="../../../Net/SSH/Transport/HMAC/MD5_96.html">Net::SSH::Transport::HMAC::MD5_96</a></li>
        
          <li><a href="../../../Net/SSH/Transport/HMAC/None.html">Net::SSH::Transport::HMAC::None</a></li>
        
          <li><a href="../../../Net/SSH/Transport/HMAC/RIPEMD160.html">Net::SSH::Transport::HMAC::RIPEMD160</a></li>
        
          <li><a href="../../../Net/SSH/Transport/HMAC/SHA1.html">Net::SSH::Transport::HMAC::SHA1</a></li>
        
          <li><a href="../../../Net/SSH/Transport/HMAC/SHA1_96.html">Net::SSH::Transport::HMAC::SHA1_96</a></li>
        
          <li><a href="../../../Net/SSH/Transport/HMAC/SHA2_256.html">Net::SSH::Transport::HMAC::SHA2_256</a></li>
        
          <li><a href="../../../Net/SSH/Transport/HMAC/SHA2_256_96.html">Net::SSH::Transport::HMAC::SHA2_256_96</a></li>
        
          <li><a href="../../../Net/SSH/Transport/HMAC/SHA2_512.html">Net::SSH::Transport::HMAC::SHA2_512</a></li>
        
          <li><a href="../../../Net/SSH/Transport/HMAC/SHA2_512_96.html">Net::SSH::Transport::HMAC::SHA2_512_96</a></li>
        
          <li><a href="../../../Net/SSH/Transport/IdentityCipher.html">Net::SSH::Transport::IdentityCipher</a></li>
        
          <li><a href="../../../Net/SSH/Transport/Kex.html">Net::SSH::Transport::Kex</a></li>
        
          <li><a href="../../../Net/SSH/Transport/Kex/DiffieHellmanGroup14SHA1.html">Net::SSH::Transport::Kex::DiffieHellmanGroup14SHA1</a></li>
        
          <li><a href="../../../Net/SSH/Transport/Kex/DiffieHellmanGroup1SHA1.html">Net::SSH::Transport::Kex::DiffieHellmanGroup1SHA1</a></li>
        
          <li><a href="../../../Net/SSH/Transport/Kex/DiffieHellmanGroupExchangeSHA1.html">Net::SSH::Transport::Kex::DiffieHellmanGroupExchangeSHA1</a></li>
        
          <li><a href="../../../Net/SSH/Transport/Kex/DiffieHellmanGroupExchangeSHA256.html">Net::SSH::Transport::Kex::DiffieHellmanGroupExchangeSHA256</a></li>
        
          <li><a href="../../../Net/SSH/Transport/Kex/EcdhSHA2NistP256.html">Net::SSH::Transport::Kex::EcdhSHA2NistP256</a></li>
        
          <li><a href="../../../Net/SSH/Transport/Kex/EcdhSHA2NistP384.html">Net::SSH::Transport::Kex::EcdhSHA2NistP384</a></li>
        
          <li><a href="../../../Net/SSH/Transport/Kex/EcdhSHA2NistP521.html">Net::SSH::Transport::Kex::EcdhSHA2NistP521</a></li>
        
          <li><a href="../../../Net/SSH/Transport/KeyExpander.html">Net::SSH::Transport::KeyExpander</a></li>
        
          <li><a href="../../../Net/SSH/Transport/PacketStream.html">Net::SSH::Transport::PacketStream</a></li>
        
          <li><a href="../../../Net/SSH/Transport/ServerVersion.html">Net::SSH::Transport::ServerVersion</a></li>
        
          <li><a href="../../../Net/SSH/Transport/Session.html">Net::SSH::Transport::Session</a></li>
        
          <li><a href="../../../Net/SSH/Transport/State.html">Net::SSH::Transport::State</a></li>
        
          <li><a href="../../../Net/SSH/Verifiers.html">Net::SSH::Verifiers</a></li>
        
          <li><a href="../../../Net/SSH/Verifiers/Lenient.html">Net::SSH::Verifiers::Lenient</a></li>
        
          <li><a href="../../../Net/SSH/Verifiers/Null.html">Net::SSH::Verifiers::Null</a></li>
        
          <li><a href="../../../Net/SSH/Verifiers/Secure.html">Net::SSH::Verifiers::Secure</a></li>
        
          <li><a href="../../../Net/SSH/Verifiers/Strict.html">Net::SSH::Verifiers::Strict</a></li>
        
          <li><a href="../../../Net/SSH/Version.html">Net::SSH::Version</a></li>
        
          <li><a href="../../../OpenSSL.html">OpenSSL</a></li>
        
          <li><a href="../../../OpenSSL/BN.html">OpenSSL::BN</a></li>
        
          <li><a href="../../../OpenSSL/PKey.html">OpenSSL::PKey</a></li>
        
          <li><a href="../../../OpenSSL/PKey/DH.html">OpenSSL::PKey::DH</a></li>
        
          <li><a href="../../../OpenSSL/PKey/DSA.html">OpenSSL::PKey::DSA</a></li>
        
          <li><a href="../../../OpenSSL/PKey/EC.html">OpenSSL::PKey::EC</a></li>
        
          <li><a href="../../../OpenSSL/PKey/OpenSSL.html">OpenSSL::PKey::OpenSSL</a></li>
        
          <li><a href="../../../OpenSSL/PKey/OpenSSL/PKey.html">OpenSSL::PKey::OpenSSL::PKey</a></li>
        
          <li><a href="../../../OpenSSL/PKey/OpenSSL/PKey/OpenSSL.html">OpenSSL::PKey::OpenSSL::PKey::OpenSSL</a></li>
        
          <li><a href="../../../OpenSSL/PKey/OpenSSL/PKey/OpenSSL/PKey.html">OpenSSL::PKey::OpenSSL::PKey::OpenSSL::PKey</a></li>
        
          <li><a href="../../../OpenSSL/PKey/OpenSSL/PKey/OpenSSL/PKey/ECError.html">OpenSSL::PKey::OpenSSL::PKey::OpenSSL::PKey::ECError</a></li>
        
          <li><a href="../../../OpenSSL/PKey/PKey.html">OpenSSL::PKey::PKey</a></li>
        
          <li><a href="../../../OpenSSL/PKey/RSA.html">OpenSSL::PKey::RSA</a></li>
        
          <li><a href="../../../String.html">String</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="module">Net::SSH::Transport::PacketStream</h1>

    <div id="description" class="description">
      
<p>A module that builds additional functionality onto the <a
href="../BufferedIo.html">Net::SSH::BufferedIo</a> module. It adds <a
href="../../SSH.html">SSH</a> encryption, compression, and packet
validation, as per the SSH2 protocol. It also adds an abstraction for
polling packets, to allow for both blocking and non-blocking reads.</p>

    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      
      <!-- Attributes -->
      <div id="attribute-method-details" class="method-section section">
        <h3 class="section-header">Attributes</h3>

        
        <div id="client-attribute-method" class="method-detail">
          <a name="client"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">client</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          <p>The client state object, which encapsulates the algorithms used to build
packets to send to the server.</p>
          
          </div>
        </div>
        
        <div id="hints-attribute-method" class="method-detail">
          <a name="hints"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">hints</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          <p>The map of “hints” that can be used to modify the behavior of the packet
stream. For instance, when authentication succeeds, an “authenticated” hint
is set, which is used to determine whether or not to compress the data when
using the “delayed” compression algorithm.</p>
          
          </div>
        </div>
        
        <div id="server-attribute-method" class="method-detail">
          <a name="server"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">server</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          <p>The server state object, which encapsulates the algorithms used to
interpret packets coming from the server.</p>
          
          </div>
        </div>
        
      </div><!-- attribute-method-details -->
      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="extended-method" class="method-detail ">
          <a name="method-c-extended"></a>

          
          <div class="method-heading">
            <span class="method-name">extended</span><span
              class="method-args">(object)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="extended-source">
<pre>
<span class="ruby-comment"># File lib/net/ssh/transport/packet_stream.rb, line 19</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">extended</span>(<span class="ruby-identifier">object</span>)
  <span class="ruby-identifier">object</span>.<span class="ruby-identifier">__send__</span>(<span class="ruby-value">:initialize_ssh</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- extended-source -->
            
          </div>

          

          
        </div><!-- extended-method -->

      
      </div><!-- public-class-method-details -->
    
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="available_for_read-3F-method" class="method-detail ">
          <a name="method-i-available_for_read-3F"></a>

          
          <div class="method-heading">
            <span class="method-name">available_for_read?</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Returns true if the IO is available for reading, and false otherwise.</p>
            

            
            <div class="method-source-code" id="available_for_read-3F-source">
<pre>
<span class="ruby-comment"># File lib/net/ssh/transport/packet_stream.rb, line 72</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">available_for_read?</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Compat</span>.<span class="ruby-identifier">io_select</span>([<span class="ruby-keyword">self</span>], <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">0</span>)
  <span class="ruby-identifier">result</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">any?</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- available_for_read-3F-source -->
            
          </div>

          

          
        </div><!-- available_for_read-3F-method -->

      
        <div id="cleanup-method" class="method-detail ">
          <a name="method-i-cleanup"></a>

          
          <div class="method-heading">
            <span class="method-name">cleanup</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Performs any pending cleanup necessary on the IO and its associated state
objects. (See <a href="State.html#method-i-cleanup">State#cleanup</a>).</p>
            

            
            <div class="method-source-code" id="cleanup-source">
<pre>
<span class="ruby-comment"># File lib/net/ssh/transport/packet_stream.rb, line 159</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cleanup</span>
  <span class="ruby-identifier">client</span>.<span class="ruby-identifier">cleanup</span>
  <span class="ruby-identifier">server</span>.<span class="ruby-identifier">cleanup</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- cleanup-source -->
            
          </div>

          

          
        </div><!-- cleanup-method -->

      
        <div id="client_name-method" class="method-detail ">
          <a name="method-i-client_name"></a>

          
          <div class="method-heading">
            <span class="method-name">client_name</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>The name of the client (local) end of the socket, as reported by the
socket.</p>
            

            
            <div class="method-source-code" id="client_name-source">
<pre>
<span class="ruby-comment"># File lib/net/ssh/transport/packet_stream.rb, line 39</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">client_name</span>
  <span class="ruby-ivar">@client_name</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">sockaddr</span> = <span class="ruby-identifier">getsockname</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-constant">Socket</span>.<span class="ruby-identifier">getnameinfo</span>(<span class="ruby-identifier">sockaddr</span>, <span class="ruby-constant">Socket</span><span class="ruby-operator">::</span><span class="ruby-constant">NI_NAMEREQD</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">rescue</span>
      <span class="ruby-keyword">begin</span>
        <span class="ruby-constant">Socket</span>.<span class="ruby-identifier">getnameinfo</span>(<span class="ruby-identifier">sockaddr</span>).<span class="ruby-identifier">first</span>
      <span class="ruby-keyword">rescue</span>
        <span class="ruby-keyword">begin</span>
          <span class="ruby-constant">Socket</span>.<span class="ruby-identifier">gethostbyname</span>(<span class="ruby-constant">Socket</span>.<span class="ruby-identifier">gethostname</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-keyword">rescue</span>
          <span class="ruby-identifier">lwarn</span> { <span class="ruby-string">&quot;the client ipaddr/name could not be determined&quot;</span> }
          <span class="ruby-string">&quot;unknown&quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- client_name-source -->
            
          </div>

          

          
        </div><!-- client_name-method -->

      
        <div id="enqueue_packet-method" class="method-detail ">
          <a name="method-i-enqueue_packet"></a>

          
          <div class="method-heading">
            <span class="method-name">enqueue_packet</span><span
              class="method-args">(payload)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Enqueues a packet to be sent, but does not immediately send the packet. The
given payload is pre-processed according to the algorithms specified in the
client state (compression, cipher, and hmac).</p>
            

            
            <div class="method-source-code" id="enqueue_packet-source">
<pre>
<span class="ruby-comment"># File lib/net/ssh/transport/packet_stream.rb, line 122</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">enqueue_packet</span>(<span class="ruby-identifier">payload</span>)
  <span class="ruby-comment"># try to compress the packet</span>
  <span class="ruby-identifier">payload</span> = <span class="ruby-identifier">client</span>.<span class="ruby-identifier">compress</span>(<span class="ruby-identifier">payload</span>)

  <span class="ruby-comment"># the length of the packet, minus the padding</span>
  <span class="ruby-identifier">actual_length</span> = <span class="ruby-value">4</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">payload</span>.<span class="ruby-identifier">bytesize</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>

  <span class="ruby-comment"># compute the padding length</span>
  <span class="ruby-identifier">padding_length</span> = <span class="ruby-identifier">client</span>.<span class="ruby-identifier">block_size</span> <span class="ruby-operator">-</span> (<span class="ruby-identifier">actual_length</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">block_size</span>)
  <span class="ruby-identifier">padding_length</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">block_size</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">padding_length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">4</span>

  <span class="ruby-comment"># compute the packet length (sans the length field itself)</span>
  <span class="ruby-identifier">packet_length</span> = <span class="ruby-identifier">payload</span>.<span class="ruby-identifier">bytesize</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">padding_length</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">packet_length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">16</span>
    <span class="ruby-identifier">padding_length</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">block_size</span>
    <span class="ruby-identifier">packet_length</span> = <span class="ruby-identifier">payload</span>.<span class="ruby-identifier">bytesize</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">padding_length</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">padding</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">padding_length</span>) { <span class="ruby-identifier">rand</span>(<span class="ruby-value">256</span>) }.<span class="ruby-identifier">pack</span>(<span class="ruby-string">&quot;C*&quot;</span>)

  <span class="ruby-identifier">unencrypted_data</span> = [<span class="ruby-identifier">packet_length</span>, <span class="ruby-identifier">padding_length</span>, <span class="ruby-identifier">payload</span>, <span class="ruby-identifier">padding</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-string">&quot;NCA*A*&quot;</span>)
  <span class="ruby-identifier">mac</span> = <span class="ruby-identifier">client</span>.<span class="ruby-identifier">hmac</span>.<span class="ruby-identifier">digest</span>([<span class="ruby-identifier">client</span>.<span class="ruby-identifier">sequence_number</span>, <span class="ruby-identifier">unencrypted_data</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-string">&quot;NA*&quot;</span>))

  <span class="ruby-identifier">encrypted_data</span> = <span class="ruby-identifier">client</span>.<span class="ruby-identifier">update_cipher</span>(<span class="ruby-identifier">unencrypted_data</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">final_cipher</span>
  <span class="ruby-identifier">message</span> = <span class="ruby-identifier">encrypted_data</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">mac</span>

  <span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;queueing packet nr #{client.sequence_number} type #{payload.getbyte(0)} len #{packet_length}&quot;</span> }
  <span class="ruby-identifier">enqueue</span>(<span class="ruby-identifier">message</span>)

  <span class="ruby-identifier">client</span>.<span class="ruby-identifier">increment</span>(<span class="ruby-identifier">packet_length</span>)

  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- enqueue_packet-source -->
            
          </div>

          

          
        </div><!-- enqueue_packet-method -->

      
        <div id="if_needs_rekey-3F-method" class="method-detail ">
          <a name="method-i-if_needs_rekey-3F"></a>

          
          <div class="method-heading">
            <span class="method-name">if_needs_rekey?</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>If the IO object requires a rekey operation (as indicated by either its
client or server state objects, see <a
href="State.html#method-i-needs_rekey-3F">State#needs_rekey?</a>), this
will yield. Otherwise, this does nothing.</p>
            

            
            <div class="method-source-code" id="if_needs_rekey-3F-source">
<pre>
<span class="ruby-comment"># File lib/net/ssh/transport/packet_stream.rb, line 167</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">if_needs_rekey?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">needs_rekey?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">needs_rekey?</span>
    <span class="ruby-keyword">yield</span>
    <span class="ruby-identifier">client</span>.<span class="ruby-identifier">reset!</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">needs_rekey?</span>
    <span class="ruby-identifier">server</span>.<span class="ruby-identifier">reset!</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">needs_rekey?</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- if_needs_rekey-3F-source -->
            
          </div>

          

          
        </div><!-- if_needs_rekey-3F-method -->

      
        <div id="next_packet-method" class="method-detail ">
          <a name="method-i-next_packet"></a>

          
          <div class="method-heading">
            <span class="method-name">next_packet</span><span
              class="method-args">(mode=:nonblock)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Returns the next full packet. If the mode parameter is :nonblock (the
default), then this will return immediately, whether a packet is available
or not, and will return nil if there is no packet ready to be returned. If
the mode parameter is :block, then this method will block until a packet is
available.</p>
            

            
            <div class="method-source-code" id="next_packet-source">
<pre>
<span class="ruby-comment"># File lib/net/ssh/transport/packet_stream.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">next_packet</span>(<span class="ruby-identifier">mode</span>=<span class="ruby-value">:nonblock</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">mode</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:nonblock</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">available_for_read?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">fill</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Disconnect</span>, <span class="ruby-string">&quot;connection closed by remote host&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">poll_next_packet</span>

  <span class="ruby-keyword">when</span> <span class="ruby-value">:block</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">loop</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">packet</span> = <span class="ruby-identifier">poll_next_packet</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">packet</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">packet</span>

      <span class="ruby-identifier">loop</span> <span class="ruby-keyword">do</span>
        <span class="ruby-identifier">result</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Compat</span>.<span class="ruby-identifier">io_select</span>([<span class="ruby-keyword">self</span>]) <span class="ruby-keyword">or</span> <span class="ruby-keyword">next</span>
        <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">any?</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">fill</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Disconnect</span>, <span class="ruby-string">&quot;connection closed by remote host&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;expected :block or :nonblock, got #{mode.inspect}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- next_packet-source -->
            
          </div>

          

          
        </div><!-- next_packet-method -->

      
        <div id="peer_ip-method" class="method-detail ">
          <a name="method-i-peer_ip"></a>

          
          <div class="method-heading">
            <span class="method-name">peer_ip</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>The IP address of the peer (remote) end of the socket, as reported by the
socket.</p>
            

            
            <div class="method-source-code" id="peer_ip-source">
<pre>
<span class="ruby-comment"># File lib/net/ssh/transport/packet_stream.rb, line 61</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">peer_ip</span>
  <span class="ruby-ivar">@peer_ip</span> <span class="ruby-operator">||=</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:getpeername</span>)
      <span class="ruby-identifier">addr</span> = <span class="ruby-identifier">getpeername</span>
      <span class="ruby-constant">Socket</span>.<span class="ruby-identifier">getnameinfo</span>(<span class="ruby-identifier">addr</span>, <span class="ruby-constant">Socket</span><span class="ruby-operator">::</span><span class="ruby-constant">NI_NUMERICHOST</span> <span class="ruby-operator">|</span> <span class="ruby-constant">Socket</span><span class="ruby-operator">::</span><span class="ruby-constant">NI_NUMERICSERV</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-string">&quot;&lt;no hostip for proxy command&gt;&quot;</span>
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- peer_ip-source -->
            
          </div>

          

          
        </div><!-- peer_ip-method -->

      
        <div id="send_packet-method" class="method-detail ">
          <a name="method-i-send_packet"></a>

          
          <div class="method-heading">
            <span class="method-name">send_packet</span><span
              class="method-args">(payload)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Enqueues a packet to be sent, and blocks until the entire packet is sent.</p>
            

            
            <div class="method-source-code" id="send_packet-source">
<pre>
<span class="ruby-comment"># File lib/net/ssh/transport/packet_stream.rb, line 114</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">send_packet</span>(<span class="ruby-identifier">payload</span>)
  <span class="ruby-identifier">enqueue_packet</span>(<span class="ruby-identifier">payload</span>)
  <span class="ruby-identifier">wait_for_pending_sends</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- send_packet-source -->
            
          </div>

          

          
        </div><!-- send_packet-method -->

      
      </div><!-- public-instance-method-details -->
    
      <div id="protected-instance-method-details" class="method-section section">
        <h3 class="section-header">Protected Instance Methods</h3>

      
        <div id="initialize_ssh-method" class="method-detail ">
          <a name="method-i-initialize_ssh"></a>

          
          <div class="method-heading">
            <span class="method-name">initialize_ssh</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Called when this module is used to extend an object. It initializes the
states and generally prepares the object for use as a packet stream.</p>
            

            
            <div class="method-source-code" id="initialize_ssh-source">
<pre>
<span class="ruby-comment"># File lib/net/ssh/transport/packet_stream.rb, line 179</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize_ssh</span>
  <span class="ruby-ivar">@hints</span>  = {}
  <span class="ruby-ivar">@server</span> = <span class="ruby-constant">State</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>, <span class="ruby-value">:server</span>)
  <span class="ruby-ivar">@client</span> = <span class="ruby-constant">State</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>, <span class="ruby-value">:client</span>)
  <span class="ruby-ivar">@packet</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">initialize_buffered_io</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- initialize_ssh-source -->
            
          </div>

          

          
        </div><!-- initialize_ssh-method -->

      
        <div id="poll_next_packet-method" class="method-detail ">
          <a name="method-i-poll_next_packet"></a>

          
          <div class="method-heading">
            <span class="method-name">poll_next_packet</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Tries to read the next packet. If there is insufficient data to read an
entire packet, this returns immediately, otherwise the packet is read,
post-processed according to the cipher, hmac, and compression algorithms
specified in the server state object, and returned as a new <a
href="../Packet.html">Packet</a> object.</p>
            

            
            <div class="method-source-code" id="poll_next_packet-source">
<pre>
<span class="ruby-comment"># File lib/net/ssh/transport/packet_stream.rb, line 192</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">poll_next_packet</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@packet</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">minimum</span> = <span class="ruby-identifier">server</span>.<span class="ruby-identifier">block_size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">4</span> <span class="ruby-operator">?</span> <span class="ruby-value">4</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">block_size</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">available</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">minimum</span>
    <span class="ruby-identifier">data</span> = <span class="ruby-identifier">read_available</span>(<span class="ruby-identifier">minimum</span>)

    <span class="ruby-comment"># decipher it</span>
    <span class="ruby-ivar">@packet</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Buffer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">server</span>.<span class="ruby-identifier">update_cipher</span>(<span class="ruby-identifier">data</span>))
    <span class="ruby-ivar">@packet_length</span> = <span class="ruby-ivar">@packet</span>.<span class="ruby-identifier">read_long</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">need</span> = <span class="ruby-ivar">@packet_length</span> <span class="ruby-operator">+</span> <span class="ruby-value">4</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">block_size</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>, <span class="ruby-node">&quot;padding error, need #{need} block #{server.block_size}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">need</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">block_size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">available</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">need</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">hmac</span>.<span class="ruby-identifier">mac_length</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">need</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-comment"># read the remainder of the packet and decrypt it.</span>
    <span class="ruby-identifier">data</span> = <span class="ruby-identifier">read_available</span>(<span class="ruby-identifier">need</span>)
    <span class="ruby-ivar">@packet</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">server</span>.<span class="ruby-identifier">update_cipher</span>(<span class="ruby-identifier">data</span>))
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># get the hmac from the tail of the packet (if one exists), and</span>
  <span class="ruby-comment"># then validate it.</span>
  <span class="ruby-identifier">real_hmac</span> = <span class="ruby-identifier">read_available</span>(<span class="ruby-identifier">server</span>.<span class="ruby-identifier">hmac</span>.<span class="ruby-identifier">mac_length</span>) <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>

  <span class="ruby-ivar">@packet</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">server</span>.<span class="ruby-identifier">final_cipher</span>)
  <span class="ruby-identifier">padding_length</span> = <span class="ruby-ivar">@packet</span>.<span class="ruby-identifier">read_byte</span>

  <span class="ruby-identifier">payload</span> = <span class="ruby-ivar">@packet</span>.<span class="ruby-identifier">read</span>(<span class="ruby-ivar">@packet_length</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">padding_length</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>)

  <span class="ruby-identifier">my_computed_hmac</span> = <span class="ruby-identifier">server</span>.<span class="ruby-identifier">hmac</span>.<span class="ruby-identifier">digest</span>([<span class="ruby-identifier">server</span>.<span class="ruby-identifier">sequence_number</span>, <span class="ruby-ivar">@packet</span>.<span class="ruby-identifier">content</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-string">&quot;NA*&quot;</span>))
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>, <span class="ruby-string">&quot;corrupted mac detected&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">real_hmac</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">my_computed_hmac</span>

  <span class="ruby-comment"># try to decompress the payload, in case compression is active</span>
  <span class="ruby-identifier">payload</span> = <span class="ruby-identifier">server</span>.<span class="ruby-identifier">decompress</span>(<span class="ruby-identifier">payload</span>)

  <span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;received packet nr #{server.sequence_number} type #{payload.getbyte(0)} len #{@packet_length}&quot;</span> }

  <span class="ruby-identifier">server</span>.<span class="ruby-identifier">increment</span>(<span class="ruby-ivar">@packet_length</span>)
  <span class="ruby-ivar">@packet</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">return</span> <span class="ruby-constant">Packet</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">payload</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- poll_next_packet-source -->
            
          </div>

          

          
        </div><!-- poll_next_packet-method -->

      
      </div><!-- protected-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

